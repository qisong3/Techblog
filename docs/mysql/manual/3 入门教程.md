---
title: 3 入门教程
date: 2020-11-03
last-update: 2020-11-03
tags:
 - MySQL
keywords:
 - MySQL
 - manual
 - Tutorial
---

本章通过演示如何使用MySQL客户端程序来创建和使用一个简单的数据库，来提供一个数据库入门教程。[mysql](https://dev.mysql.com/doc/refman/8.0/en/mysql.html)(有时被称为终端监视器或仅仅是监视器)是一个交互式程序，使您能够连接到mysql服务器，运行查询，并查看结果。mysql也可以在批处理模式下使用:你先将查询放在一个文件中，然后告诉mysql执行文件的内容。这里介绍了使用mysql的两种方式。

要查看mysql提供的选项列表，请使用 ——help 选项调用它：
```sql
shell> mysql --help
```

本章假设mysql已经安装在您的机器上，并且有一个可以连接的mysql服务器。如果这不是真的，联系你的MySQL管理员。(如果您是管理员，您需要查阅本手册的相关部分，如第5章，MySQL服务器管理)。

本章描述了建立和使用数据库的整个过程。如果您只对访问现有数据库感兴趣，那么您可能希望跳过描述如何创建数据库及其包含的表的部分。

因为本章本质上是教程，所以有必要省略很多细节。请参阅手册的相关章节，以获得这里所涵盖主题的更多信息。

## 3.1 连接及断开服务器

要连接到服务器，通常需要在调用MySQL时提供一个MySQL用户名，大多数情况下还需要提供一个密码，如果登录的是其他主机的服务，则还需要明确host地址。一般的连接命令如下：
```sql
    shell> mysql -h host -u user -p
    Enter password: ********
```
host和user示运行MySQL服务器的主机名和MySQL帐户的用户名。当输入正确参数以后，会弹出`Enter password:`的提示符，密码也正确以后，将进入MySQL命令行
```sql
    shell> mysql -h host -u user -p
    Enter password: ********
    Welcome to the MySQL monitor.  Commands end with ; or \g.
    Your MySQL connection id is 25338 to server version: 8.0.24-standard
    
    Type 'help;' or '\h' for help. Type '\c' to clear the buffer.
    
    mysql>
```
`mysql>`提示符告诉您mysql已经准备好输入SQL语句了。
如果登录的是本机的服务器，则可以省略host，类似如下
```sql
    shell> mysql -u user -p
```
如果登录的时候，显示如下错误
> ERROR 2002 (HY000): Can't connect to local MySQL server through socket '/tmp/mysql.sock'

这说明MySQL服务并没有开启，可以咨询数据库管理员或者参考[Chapter 2, Installing and Upgrading MySQL](https://dev.mysql.com/doc/refman/8.0/en/installing.html)

部分服务器允许用户在本机上以匿名身份访问数据库，这样的话只需要直接输入`mysql`，不用增加任何选项，就可以直接进入MySQL命令行中了

```sql 
    shell> mysql
```
在MySQL命令行中，输入quit或者\q，在Unix系统中可以键入Ctrl+D来退出命令行

## 3.2 进入查询

在进行本节操作之前，请确保已经可以正确登录到数据库中。登录以后没没有选中任何库，下面需要做的就是创建表，写入和读取数据等。本节将介绍一些查询的基本概念，通过这些查询可以熟悉MySQL的工作原理。

下面这是一个简单的查询，询问数据库本身的版本和时间。在mysql>提示符后面键入如下：

```sql
    mysql> SELECT VERSION(), CURRENT_DATE;
    +-----------+--------------+
    | VERSION() | CURRENT_DATE |
    +-----------+--------------+
    | 8.0.21    | 2020-11-06   |
    +-----------+--------------+
    1 row in set (0.00 sec)
    mysql>
```
这个查询延时了关于MySQL的几个点:

- 查询包含SQL语句，以分号结尾。(部分语句不需要分号结尾，如quit)
- 当您发出一个查询时，mysql将它发送到服务器以执行并显示结果，然后打印另一个`mysql>`提示，表示它已准备好进行另一个查询
- mysql以表格形式(行和列)显示查询输出,第一行包含列的标签。下面的行是查询结果.通常，列标签是您从数据库表中获取的列的名称。如果查询的是表达式的值，而不是表列的值(如上面的查询)，mysql使用表达式本身给列加上标签。
- mysql会显示返回的行数和查询执行的时间，这会让您大致了解服务器性能。不过这些值并不精确，因为它们表示挂钟时间(而不是CPU或机器时间)，而且它们会受到服务器负载和网络延迟等因素的影响

MySQL的关键字不区分大小写，下面几个查询是等效的
```sql
    mysql> SELECT VERSION(), CURRENT_DATE;
    mysql> select version(), current_date;
    mysql> SeLeCt vErSiOn(), current_DATE;
```
这里举另一个例子，显示MySQL也可以作为一个计算器使用
```sql
    mysql> SELECT SIN(PI()/4), (4+1)*5;
    +------------------+---------+
    | SIN(PI()/4)      | (4+1)*5 |
    +------------------+---------+
    | 0.70710678118655 |      25 |
    +------------------+---------+
    1 row in set (0.02 sec)
```
可以在一行中写入一条语句并以分号结尾，也可以把两条语句写到一起。
```sql
    mysql> SELECT VERSION(); SELECT NOW();
    +-----------+
    | VERSION() |
    +-----------+
    | 8.0.13    |
    +-----------+
    1 row in set (0.00 sec)
    
    +---------------------+
    | NOW()               |
    +---------------------+
    | 2018-08-24 00:56:40 |
    +---------------------+
    1 row in set (0.00 sec)
```
也可以将一条查询语句分开到多行中。MySQL是以分号作为SQL结束的标识，而并不是行尾。下面是一个多行表达式的示例：
```sql
    mysql> SELECT
        -> USER()
        -> ,
        -> CURRENT_DATE;
    +---------------+--------------+
    | USER()        | CURRENT_DATE |
    +---------------+--------------+
    | jon@localhost | 2018-08-24   |
    +---------------+--------------+
```
在上面这个例子中，当换行以后，`->`会提示你这条语句并没有结束，这是一个有价值的反馈。

在执行查询语句的过程中，如果决定了要半途终止，可以键入`\c`。
```sql
    mysql> SELECT
        -> USER()
        -> \c
    mysql>
```
当键入`\c`以后，出现新的`mysql->`提示符，意味着可以键入新的命令了。下面的提示符显示了它们出现的含义。
|提示符|含义|
|:--|:--|
|mysql>|准备好新的查询|
|->|等待多行查询的下一行|
|'>|等待下一行，并且完成前面出现的单引号|
|">|等待下一行，并且完成前面出现的双引号|
|`>|等待下一行，并且完成前面出现的反斜杠|
|/*>|等待下一行，并且完成前面出现的(/*)|

多行查询一般出现在进行单行语句查询时忘了输入结束的分号。比如输入了如下语句
```sql 
    mysql> SELECT USER()
    ->
```
当你还在怀疑为啥没有输出的时候，命令行也在等你键入后面的语句，输入一个分号可以让MySQL执行。

```sql
    mysql> SELECT USER()
        -> ;
    +---------------+
    | USER()        |
    +---------------+
    | jon@localhost |
    +---------------+
```
当你键入下面的语句时，注意`'>`提示符，它暗示你还有未结束的字符串，另外有没有看到下面语句中的错误？(`'Smith`少了右边半边括号)
```sql
    mysql> SELECT * FROM my_table WHERE name = 'Smith AND age < 30;
    '>
```

当出现这种情况下，又不能回到第一行，可以键入`\c`来结束这个错误的输入语句，这样提示符回到`mysql>`,可以执行下条语句了。

::: tip
从现在开始，多行语句将在没有辅助（->或其他）提示的情况下编写，从而更方便复制粘贴，可以自己试验一下。
:::

## 3.3 创建并使用库

一旦了解了任何进入SQL命令行，就可以正式开始操作数据库了。

假设您的家里(您的动物园)有几只宠物，您想要跟踪关于它们的各种类型的信息。您可以通过创建表来保存数据，并用所需的信息加载它们来实现这一点。然后，您可以通过从表中检索数据来回答关于您的动物的不同类型的问题。

本节向您展示如何执行以下操作:

- 创建数据库
- 创建表格
- 加载表格
- 以多种形式从表格中获取数据
- 使用多张表格

动物园数据库设计得比较简单，但是在现实世界中找到一个相似的数据库应用场景并不难。例如，农民可以使用这样的数据库来跟踪牲畜，兽医可以使用这样的数据库来跟踪病人记录。动物园数据库可以从MySQL的网站上获得，在[https://dev.mysql.com/doc/](https://dev.mysql.com/doc/)。

使用`SHOW`命令来展示服务器上已经存在的库
```sql
mysql> SHOW DATABASES;
+----------+
| Database |
+----------+
| mysql    |
| test     |
| tmp      |
+----------+
```
mysql库描述用户访问特权。test库通常可以作为用户进行测试的工作区。

显示的数据库在不同的机器上可能不同，`SHOW DATABASES`只显示用户对拥有权限的库，没有权限的则不展示。

如果test库存在，可以直接进入这个库

```sql
    mysql> USE test
    Database changed
```

`USE`命令和`QUIT`一样，不需要分号，`USE`命令必须写在同一行上。

如果有权限的话，现在可以直接访问test库了。如果别人也对这个库有权限，那么自己所做的任何修改，都可能被别人抹去。因此可以向管理员申请一个独占的库。假设你想操作menagerie库。管理员可以执行如下命令：
```sql 
    mysql> GRANT ALL ON menagerie.* TO 'your_mysql_name'@'your_client_host';
```

`your_mysql_name`是MySQL的用户名，`your_client_host`是连接数据库的主机。

### 3.3.1 创建并选中库

如果管理员已经为你创建了menagerie库并授予你权限，那么可以继续使用了。否则，需要自己动手来创建：
```sql 
    mysql> CREATE DATABASE menagerie;
```
在Unix体系中，数据库名是大小写敏感的(SQL语句不是),所以必须要以`menagerie`而不是` Menagerie`，`MENAGERIE`或者其他变体来访问。这个对于表名同样适用。

在Windows系统中，并没有这个限制，尽管您必须在整个给定查询中使用相同的字母大小写引用数据库和表。不过鉴于重重原因，建议创建和使用库时使用相同的大小写。

::: tip Note
如果在创建数据库时得到了下面的错误"ERROR 1044 (42000): Access denied for user 'micah'@'localhost' to database 'menagerie'"。这说明你并没有权力去建库。
:::

仅仅是建库并没有默认选中这个库，必须显式执行。要将menagerie设置为当前选中的数据库，使用如下语句：
```SQL
    mysql> USE menagerie
    Database changed
```
一个库只能创建一次，但是每次开始MySQL对话的时候都需要单独引用。可以像上面一样使用USE来选中，可以如下面索视在调用MySQL命令行的的时候就显示选中库，只需要声明需要连接的库名作为必要的参数。

```SQL
    shell> mysql -h host -u user -p menagerie
    Enter password: ********
```

::: warning
命令行中的`menagerie`并不是待输入的密码。如果想直接在-p后面输入密码，则在-p和密码之间不能留有空行(-ppassword 而不是-p password)。不过，不建议在命令行中直接输入密码，因为这样密码可能泄露给其他可以登录这台电脑的用户。
:::
::: tip
要查看当前选中了哪个数据库，可以执行 SELECT DATABASE()语句。
:::

### 3.3.2 创建表格

创建数据库是小菜一碟，但是目前这个库还是空的，可以从SHOW TABLES中看出选中的表:

```sql
    mysql> SHOW TABLES;
    Empty set (0.00 sec)
```

该如何组织数据库，如何建表和设置表字段才是有挑战的部分。

假设你需要一个记录你每一个宠物的表格，表格名称可以称为pet，这个表中理所应当最少应该包含每个宠物的名字。当然，一个表格中只有名字没什么意思，可能还需要包含其他信息。比如说，如果不止一个家庭成员喂养了宠物，那么可能需要列出每个宠物的主任。除此除外，可能还需要包含宠物的基本信息如品种，性别等。

年龄呢？这个就有点意思了，因为这个可能不适合存储在数据库中。因为随着时间推移，每年都需要手动修改这个记录。因此，保存宠物的出生日期这种固定值可能更适合。这样的话，不管什么时候需要知道宠物的年龄，只需要将现在的时间和出生日期做一个计算就可以得到。MySQL提供了执行日期算术的函数，所以这并不困难。

存储出生日期而非年龄还有其他优势：

- 可以使用数据库执行任务，比如为即将到来的宠物生日生成提醒。(如果你人为这种计算很傻，那其实现实世界中也是存在此类查询的。比如在商业场景下，需要计算某个日期该给哪位客户发生日祝福了。。)

- 还可以联合其他字段进行日期的相关性计算。比如说，如果记录了宠物的死亡日期，那么也可以计算宠物活了多久。

还可以想到pet表中其他的游泳信息，但是已经提到的这些字段已经足够了， name, owner, species, sex, birth, 和 death。

使用[CREATE TABLE](https://dev.mysql.com/doc/refman/8.0/en/create-table.html)表达式来声明表的构造：
```SQL
    mysql> CREATE TABLE pet (name VARCHAR(20), owner VARCHAR(20),
           species VARCHAR(20), sex CHAR(1), birth DATE, death DATE);
```

对于name、owner和species列，[VARCHAR](https://dev.mysql.com/doc/refman/8.0/en/char.html)是一个很好的选择，因为列值的长度不同。这些列定义中的长度不需要都相同，也不需要是20。通常可以选择1到65535之间的任何长度，任何对您来说最合理的长度都可以。如果您做了一个糟糕的选择，后来需要一个更长的字段，MySQL提供了一个[ALTER TABLE](https://dev.mysql.com/doc/refman/8.0/en/alter-table.html)语句。

可以选择几种类型的值来表示动物记录中的性别，比如‘m’和‘f’，或者‘male’和‘female’。使用“m”和“f”是最简单的。

在birth和death字段上使用[Date](https://dev.mysql.com/doc/refman/8.0/en/datetime.html)是一个显而易见的选择。

一旦创建好表格，[SHOW TABLES](https://dev.mysql.com/doc/refman/8.0/en/show-tables.html)将会显示如下输出：

```
mysql> SHOW TABLES;
+---------------------+
| Tables in menagerie |
+---------------------+
| pet                 |
+---------------------+

```
要验证表是否按预期方式创建，请使用[DESCRIBE](https://dev.mysql.com/doc/refman/8.0/en/describe.html)语句:

```sql
mysql> DESCRIBE pet;
+---------+-------------+------+-----+---------+-------+
| Field   | Type        | Null | Key | Default | Extra |
+---------+-------------+------+-----+---------+-------+
| name    | varchar(20) | YES  |     | NULL    |       |
| owner   | varchar(20) | YES  |     | NULL    |       |
| species | varchar(20) | YES  |     | NULL    |       |
| sex     | char(1)     | YES  |     | NULL    |       |
| birth   | date        | YES  |     | NULL    |       |
| death   | date        | YES  |     | NULL    |       |
+---------+-------------+------+-----+---------+-------+

```

可以在任何时候使用[DESCRIBE](https://dev.mysql.com/doc/refman/8.0/en/describe.html)，比如忘记了表中有多少列或者各个字段的类型。

可以在[Chapter 11, Data Types](https://dev.mysql.com/doc/refman/8.0/en/data-types.html)查阅更多MySQL的数据类型。

### 3.3.3 将数据加载到表格中

创建完表格，加下来就是填充表格的数据了。[LOAD DATA](https://dev.mysql.com/doc/refman/8.0/en/load-data.html)和[INSERT](https://dev.mysql.com/doc/refman/8.0/en/insert.html) 将非常游泳。

假设宠物的记录描述如下。(注意到MySQL的date格式是'YYYY-MM-DD'，可能与平时使用的格式有所不同)

<colgroup><col width="10%"><col width="10%"><col width="10%"><col width="05%"><col width="20%"><col width="20%"></colgroup><thead><tr>
            <th scope="col">name</th>
            <th scope="col">owner</th>
            <th scope="col">species</th>
            <th scope="col">sex</th>
            <th scope="col">birth</th>
            <th scope="col">death</th>
          </tr></thead><tbody><tr>
            <th scope="row">Fluffy</th>
            <td>Harold</td>
            <td>cat</td>
            <td>f</td>
            <td>1993-02-04</td>
            <td></td>
          </tr><tr>
            <th scope="row">Claws</th>
            <td>Gwen</td>
            <td>cat</td>
            <td>m</td>
            <td>1994-03-17</td>
            <td></td>
          </tr><tr>
            <th scope="row">Buffy</th>
            <td>Harold</td>
            <td>dog</td>
            <td>f</td>
            <td>1989-05-13</td>
            <td></td>
          </tr><tr>
            <th scope="row">Fang</th>
            <td>Benny</td>
            <td>dog</td>
            <td>m</td>
            <td>1990-08-27</td>
            <td></td>
          </tr><tr>
            <th scope="row">Bowser</th>
            <td>Diane</td>
            <td>dog</td>
            <td>m</td>
            <td>1979-08-31</td>
            <td>1995-07-29</td>
          </tr><tr>
            <th scope="row">Chirpy</th>
            <td>Gwen</td>
            <td>bird</td>
            <td>f</td>
            <td>1998-09-11</td>
            <td></td>
          </tr><tr>
            <th scope="row">Whistler</th>
            <td>Gwen</td>
            <td>bird</td>
            <td></td>
            <td>1997-12-09</td>
            <td></td>
          </tr><tr>
            <th scope="row">Slim</th>
            <td>Benny</td>
            <td>snake</td>
            <td>m</td>
            <td>1996-04-29</td>
            <td></td>
</tr></tbody>

因为您是从一个空表开始的，所以填充它的一种简单方法是创建一个包含每个动物一行的文本文件，然后用一条语句将文件的内容加载到表中。

您可以创建一个文本文件pet.txt，每行包含一条记录，值由制表符分隔，并按照创建表时列的顺序给出。对于缺失的字段，可以使用NULL数据。在text文件中表示这些值，可以用换行符代替。例如，小鸟Whistler的记录如下所示(值之间的空格是单个制表符)

``` 
Whistler        Gwen    bird    \N      1997-12-09      \N
```
要将文本文件pet.txt加载到pet表中，请使用以下语句
``` SQL
    mysql> LOAD DATA LOCAL INFILE '/path/pet.txt' INTO TABLE pet;
```
(在运行macOS的苹果机器上，使用以'\r'作为换行符。)

如果愿意，可以在LOAD DATA语句中显式地指定列值分隔符和行结束标记符，但默认是tab和换行符。对于语句正确读取文件pet.txt来说，这些已经足够了。

如果语句执行失败了，可能是MySQL没有开启使用本地文件，详情参见[Section 6.1.6, “Security Considerations for LOAD DATA LOCAL”](https://dev.mysql.com/doc/refman/8.0/en/load-data-local-security.html)。

如果想添加一条记录，那么[INSERT](https://dev.mysql.com/doc/refman/8.0/en/insert.html)地址是更合适的。最简单的方式，是按照建表时规定的列输入插入地段。假设Diane有一只叫Puffball的新仓鼠，可以使用像这样的[INSERT](https://dev.mysql.com/doc/refman/8.0/en/insert.html)语句添加一个新记录
```sql 
mysql> INSERT INTO pet
       VALUES ('Puffball','Diane','hamster','f','1999-03-30',NULL);
```
字符串和日期值在这里被指定为带引号的字符串,在[INSERT](https://dev.mysql.com/doc/refman/8.0/en/insert.html)语句中，可以直接插入NULL值，但是不需要`\N`换行符了。

从这个示例中，您应该能够看到，在最初使用多个[INSERT](https://dev.mysql.com/doc/refman/8.0/en/insert.html)语句而不是单个[Load DATA](https://dev.mysql.com/doc/refman/8.0/en/load-data.html)语句加载记录时，会涉及更多的输入。


### 3.3.4 从表格中获取信息

SELECT语句用于从表中提取信息。这个表述的一般形式是:
```sql
    SELECT what_to_select
    FROM which_table
    WHERE conditions_to_satisfy;

```
- what_to_select 需要查询的内容，可以是列的列表，或者`*`代表所有列 
- which_table 代表要从哪个表中进行查询，where语句是可选的
- conditions_to_satisfy 代表所查询的行需要满足的一个或者多个条件

#### 3.3.4.1 查询所有数据
