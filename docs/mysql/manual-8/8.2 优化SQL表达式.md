---
title: 8.2 优化SQL表达式
date: 2020-12-01
last-update: 2020-11-01
tags:
 - MySQL
keywords:
 - MySQL
 - manual
 - 优化
---


数据库应用程序的核心逻辑是通过SQL语句执行的，无论是直接通过解释器发出还是通过API在后台提交。本节中的调优指南有助于加速所有类型的MySQL应用程序。这些指导方针涵盖了读和写数据的SQL操作、SQL操作的一般幕后开销以及特定场景中使用的操作(如数据库监视)。

## 8.2.1 优化查询语句

查询以SELECT语句的形式执行数据库中的所有查找操作。调优这些语句是最重要的任务，无论是为动态web页面实现亚秒级的响应时间，还是减少生成大量夜间报告的时间。

除了SELECT语句之外，查询的调优技术也适用于诸 CREATE TABLE...AS SELECT, INSERT INTO...SELECT以及DELETE语句中的WHERE表达式。这些语句还有其他性能考虑因素，因为它们将写操作与面向读的查询操作结合在一起。

NDB集群支持一种下推式的优化通过将连接查询发到各个NDB节点中，以便可以分布式同步执行查询。更多详情请参阅[Conditions for NDB pushdown joins. ](https://dev.mysql.com/doc/refman/8.0/en/mysql-cluster-options-variables.html#ndb_join_pushdown-conditions)

优化查询的主要考虑事项是:

- 将一个SELECT ... WHERE查询变快，第一件事是查看是否可以添加索引。在WHERE子句中使用的列上设置索引，以加速结果的计算、筛选和最终检索。为了避免浪费磁盘空间，构造一个小的索引集来加速应用程序中使用的许多相关查询。
  
  索引对于使用联接和外键等功能引用不同表的查询尤为重要。可以使用[EXPLAIN](https://dev.mysql.com/doc/refman/8.0/en/explain.html)语句确定SELECT使用哪些索引。参照[Section 8.3.1, “How MySQL Uses Indexes” and Section 8.8.1, “Optimizing Queries with EXPLAIN”.](https://dev.mysql.com/doc/refman/8.0/en/mysql-indexes.html)

- 隔离和调优查询的任何部分，例如函数调用，这会花费过多的时间。根据查询的结构，可以对结果集中的每一行调用一次函数，甚至对表中的每一行调用一次函数，这会极大地提高效率。
- 最小化查询中的全表扫描次数，特别是对于大表。
- 通过定期使用[ANALYZE TABLE](https://dev.mysql.com/doc/refman/8.0/en/analyze-table.html)语句使表统计信息保持最新状态，因此优化器具有构造有效执行计划所需的信息。
- 了解每个表的存储引擎特定的调整技术，索引技术和配置参数。InnoDB和MyISAM都有一套指导原则来实现和保持查询的高性能。详情参考[Section 8.5.6, “Optimizing InnoDB Queries”](https://dev.mysql.com/doc/refman/8.0/en/optimizing-innodb-queries.html)和[SECTION 8.6.1 Optimizing MyISAM Queries](https://dev.mysql.com/doc/refman/8.0/en/optimizing-queries-myisam.html)
- 可以优化InnoDB表的单查询事务，参考[ Section 8.5.3, “Optimizing InnoDB Read-Only Transactions”](https://dev.mysql.com/doc/refman/8.0/en/innodb-performance-ro-txn.html)
- 避免以难以理解的方式转换查询，特别是在优化器自动执行某些相同转换的情况下。
- 如果性能问题不能通过基本准则之一轻松解决，那么通过阅读EXPLAIN计划并调整索引、WHERE子句、join子句等来研究特定查询的内部细节。(当你达到一定的专业水平时，阅读EXPLAIN计划可能是你解决每个问题的第一步)
- 调整MySQL用于缓存的内存区域的大小和属性。由于InnoDB缓冲池、MyISAM键缓存和MySQL查询缓存的有效使用，重复查询运行速度更快，因为结果是在第二次和后续时间从内存中检索的。
- 即使是使用缓存内存区域快速运行的查询，您仍然可以进一步优化，使它们需要更少的缓存内存，从而使您的应用程序更具可伸缩性。可伸缩性意味着您的应用程序可以处理更多的并发用户、更大的请求等等，而不会经历性能的大幅下降。
- 处理锁问题，在锁问题中，查询的速度可能会受到同时访问表的其他会话的影响。

### 8.2.1.1 WHERE语句优化

