---
title: 8.1 优化概览
date: 2020-12-01
last-update: 2020-11-01
tags:
 - MySQL
keywords:
 - MySQL
 - manual
 - 优化
---

数据库性能取决于数据库级别的几个因素，例如表、查询和配置设置。这些软件结构导致在硬件级别执行CPU和I / O操作，您必须将这些操作最小化并使其尽可能高效。在研究数据库性能时，首先要学习软件方面的高级规则和指导原则，使用时钟周期来衡量性能。成为专家后，您将了解有关内部情况的更多信息，并开始测量诸如CPU周期和I / O操作之类的东西。

典型用户的目标是从现有的软件和硬件配置中获得最佳的数据库性能。高级用户寻找机会改进MySQL软件本身，或开发自己的存储引擎和硬件设备，以扩展MySQL生态系统。

## 8.1.1 在数据库级别进行优化

确保数据库快速运行最关键的因素是它的基本设计：

- 表结构是否合理？具体来说，列是否具有正确的数据类型，以及每个表是否具有适合工作类型的列？例如，经常执行更新的应用程序通常有多个包含少量列的表，而分析大量数据的应用程序通常有少量包含多个列的表。
- 索引设计得是否合理以提升效率？
- 您是否为每个表使用了适当的存储引擎，并利用了所使用的每个存储引擎的优势和特性
- 特别是，事务存储引擎(如InnoDB)或非事务存储引擎(如MyISAM)的选择对于性能和可伸缩性非常重要。
::: tip
InnoDB是新表的默认存储引擎。在实践中，高级的InnoDB性能特性意味着InnoDB表的性能通常优于简单的MyISAM表，特别是对于一个经常使用的数据库。
:::
- 每个表是否使用适当的行格式？这种选择还取决于表使用的存储引擎。特别的，压缩表使用较少的磁盘空间，因此需要较少的磁盘I / O来读取和写入数据。压缩适用于InnoDB表的所有工作负载，也适用于只读MyISAM表。
- 应用程序是否使用了适当的锁策略？例如，在可能的情况下允许共享访问，以便数据库操作可以并发运行;在适当的情况下请求独占访问，以便关键操作获得最高优先级。同样，存储引擎的选择也很重要。InnoDB存储引擎可以在不需要用户参与的情况下处理大部分的锁问题，从而实现更好的数据库并发性，减少代码的试验和调优。
- 是否所有用于缓存的内存区域大小正确？也就是说，要大到足以容纳频繁访问的数据，但又不能大到超载物理内存并导致分页。需要配置的主要内存区域是InnoDB缓冲池和MyISAM密钥缓存。

## 8.1.2 硬件级别的优化
随着数据库变得越来越繁忙，任何数据库应用程序最终都会遇到硬件限制。DBA必须评估是否可以调优应用程序或重新配置服务器以避免这些瓶颈，或者是否需要更多的硬件资源。系统瓶颈通常来自这些内容：
- 磁盘寻道。磁盘需要时间来查找数据。对于现代磁盘，这一过程的平均时间通常低于10ms，因此理论上我们每秒可以执行大约100次请求。对于新磁盘，这段时间的改进很慢，并且很难针对单个表进行优化。优化寻道时间的方法是将数据分布到多个磁盘上。
- 磁盘读写。当磁盘处于正确位置时，我们需要读取或写入数据。对于现代磁盘，一个磁盘可提供至少10–20MB / s的吞吐量。这比寻道更容易优化，因为可以并行地从多个磁盘读取数据。
- CPU执行周期。当数据在主存中时，我们必须对其进行处理以获得结果。与内存量相比，使用大型表是最常见的限制因素。但对于小型表，速度通常不是问题。
- 内存带宽。当CPU需要超过CPU缓存容量的数据时，主内存带宽成为瓶颈。对于大多数系统来说，这是一个不常见的瓶颈，但需要注意。

## 8.1.3 平衡可移植性和性能
在一个可以直的MySQL程序中使用性能导向的SQL扩展，可以将MySQL专有的关键词防止在/*! */注释间。其他SQL服务器便可以忽略这些被注释了的关键词。详情可参考[Section 9.7, “Comments”](https://dev.mysql.com/doc/refman/8.0/en/comments.html)
